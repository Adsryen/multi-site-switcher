# multi-site-switcher

多站点账号一键切换的浏览器扩展。为每个网站单独编写适配逻辑，在后台/选项页集中管理账号，支持在站点页面一键切换登录身份。

> 说明：本 README 为先行版本，包含通用设计与使用说明。仓库实际结构与实现细节落地后，请据实补充“TODO/占位”部分。

---

## 特性

- **多站点适配**：为不同网站分别实现登录/登出/状态检测逻辑，按域名或站点键归档。
- **一键切换账号**：在目标网站执行“登出 → 清理（可选）→ 登录”流程，尽量减少人工操作。
- **账号集中管理**：在扩展的后台/选项页统一新增、编辑、删除、搜索账号，支持备注、标签等元信息。
- **权限最小化**：仅在必要站点与场景下请求权限（示例见下文“权限说明”）。
- **跨浏览器（优先 MV3）**：优先适配基于 Chromium 的浏览器（Chrome、Edge、Opera 等）。Firefox 将视 MV3 支持情况适配。
- **本地优先与隐私**：账号数据默认存储在本地（`chrome.storage`/`browser.storage`）。可选主密码与加密方案（见“安全与隐私”，TODO）。

## 浏览器支持

- Chrome/Edge/Opera（Manifest V3 优先）。
- Firefox（Manifest V3 支持进度与差异需另行验证）。

> 提示：不同浏览器对权限、API、MV3 Service Worker 支持存在差异，实际行为以目标浏览器为准。

## 安装

### 方式一：从源码临时加载（开发调试）

Chromium（Chrome/Edge）：

1. 打开 `chrome://extensions` 或 `edge://extensions`.
2. 打开“开发者模式”。
3. 点击“加载已解压的扩展程序（Load unpacked）”。
4. 选择包含 `manifest.json` 的目录。
   - 若使用构建工具，请先构建再选择构建输出目录（如 `dist/`，具体以工程实际为准）。

Firefox：

1. 打开 `about:debugging#/runtime/this-firefox`.
2. 点击“临时载入附加组件”，选择 `manifest.json`.

### 方式二：打包后安装（可选）

若项目采用打包工具（示例：Vite/Webpack/Rollup 等），请先安装依赖并构建，再加载输出目录。

示例命令（按实际包管理器选择其一，若未使用构建工具可忽略）：

```bash
# npm
npm install
npm run build

# pnpm
pnpm install
pnpm build

# yarn
yarn
yarn build
```

构建完成后，按“方式一”步骤选择构建输出目录进行加载。

## 使用

1. 在目标网站页面，点击扩展图标打开弹出页（Popup）.
2. 从账号列表中选择要切换的账号，或先在“选项/设置”页添加账号。
3. 触发切换后，扩展将按该站点适配流程执行登出/清理/登录等操作。

> 注意：部分网站存在验证码、二步验证、CSRF/同源策略或登录风控，可能需要人工配合或采用更稳健的适配策略.

## 账号管理（后台/选项页）

- **新增/编辑/删除**：为指定站点保存多个账号（用户名、密码、Cookie/Token 等视策略而定）.
- **搜索与标签**：根据站点、标签或备注快速定位账号.
- **导入/导出**：以本地文件（JSON 等）导入/导出账号记录（请谨慎处理敏感信息）.
- **主密码（可选，TODO）**：为本地敏感字段加密，启动扩展或敏感操作时解锁.

## 站点适配（开发约定）

为每个网站实现独立的“适配器”，封装登录切换所需的页面操作或接口调用.


### 典型适配策略

- 表单自动填充与提交（`scripting` 注入、DOM 操作）.
- Cookie/LocalStorage 清理与写入（需 `cookies`/`storage` 权限，谨慎使用）.
- 打开/跳转到登录页、处理重定向与回跳参数.
- 检测登录态（读取页面元素、调用站点接口等）.

## 权限说明（按需最小化）

- `storage`：保存账号与扩展配置.
- `scripting`：向目标页面注入脚本以执行表单填充、点击等操作.
- `activeTab` 或 `host_permissions`：允许在当前或特定站点注入.
- `cookies`（可选）：在需要以 Cookie 为主的策略下读写/清理站点 Cookie.
- `tabs`（可选）：在新开/切换标签页、导航等场景使用.

> 最终以 `manifest.json` 为准，请仅在确有需要时申请相应权限.

## 安全与隐私

- **本地优先**：默认将账号数据存储在本地浏览器存储（`chrome.storage`/`browser.storage`）.
- **主密码与加密（TODO）**：可选启用主密码，使用对称加密（例如 AES-GCM）保护敏感字段.
- **无后台上报**：不内置远程上传或统计.若未来引入同步能力，将明确说明并提供开关.
- **导出提示**：导出包含敏感信息（如密码/Cookie）的文件请自行妥善保管.

## 项目结构（建议示例）


## 开发与调试

- **无打包场景**：直接编辑源文件，刷新扩展（Chrome 扩展页点击“刷新”）.
- **有打包场景**：
  - 安装依赖并运行开发命令（例如 `npm run dev`/`pnpm dev`/`yarn dev`）.
  - 产出到临时目录（如 `dist/`），在扩展页指向该目录.
- **调试技巧**：
  - Service Worker 日志可在扩展管理页点击“Service Worker 检查视图”查看.
  - 内容脚本日志在对应网页的开发者工具 Console 中查看.
  - 适配器建议添加可控的调试日志（如 `debug` 开关）.

## 路线图（Roadmap）

- [ ] 核心切换流程稳定化（登出/清理/登录）.
- [ ] 主密码与本地加密（可选）.
- [ ] 导入/导出与数据迁移.
- [ ] 快捷键与上下文菜单（右键）集成.
- [ ] 站点适配规范与模板生成脚本.
- [ ] 更完善的错误提示与可观测性（日志、错误码）.
- [ ] Firefox 兼容性验证与适配.

## 已适配网站（占位）


## 贡献

- 欢迎提交 Issue/PR：
  - 报告 Bug 或提出新需求.
  - 贡献新的站点适配器或改进现有逻辑.
- 代码风格、提交信息与分支策略可在 CONTRIBUTING（待补充）中约定.

## 许可

本项目采用 MIT License，详见 `LICENSE` 文件.

---

### TODO（待补充的信息）

- 扩展实际名称与图标.
- 真实的项目结构与构建命令（若有）.
- 已适配网站清单与功能差异.
- 是否引入主密码加密及其实现细节.
- 具体所需权限与理由（`manifest.json` 为准).
